<!DOCTYPE html>
<html>
<head>
<meta charset="EUC-KR">
<title>upload file</title>

<script>

window.onload=function(){
var singleUploadForm = document.querySelector('#singleUploadForm');
var singleFileUploadInput = document.querySelector('#singleFileUploadInput');
var singleFileUploadError = document.querySelector('#singleFileUploadError');
var singleFileUploadSuccess = document.querySelector('#singleFileUploadSuccess');

var multipleUploadForm = document.querySelector('#multipleUploadForm');
var multipleFileUploadInput = document.querySelector('#multipleFileUploadInput');
var multipleFileUploadError = document.querySelector('#multipleFileUploadError');
var multipleFileUploadSuccess = document.querySelector('#multipleFileUploadSuccess');

function uploadSingleFile(file) {
    var formData = new FormData();
    formData.append("fileArr", file);

    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/file-storage/stores/store1");

    xhr.onload = function() {
        console.log(xhr.responseText);
        var response = JSON.parse(xhr.responseText);
        if(xhr.status == 200) {
            singleFileUploadError.style.display = "none";
            singleFileUploadSuccess.innerHTML = "<p>File Uploaded Successfully.</p><p>DownloadUrl : <a href='" + response.fileDownloadUri + "' target='_blank'>" + response.fileDownloadUri + "</a></p>";
            singleFileUploadSuccess.style.display = "block";
        } else {
            singleFileUploadSuccess.style.display = "none";
            singleFileUploadError.innerHTML = (response && response.message) || "Some Error Occurred";
        }
    }

    xhr.send(formData);
}

function uploadMultipleFiles(files) {
    var formData = new FormData();
    for(var index = 0; index < files.length; index++) {
        formData.append("fileArr", files[index]);
    }

    var xhr = new XMLHttpRequest();
    xhr.open("POST", "/file-storage/stores/store1");
    
    xhr.onload = function() {
        console.log(xhr.responseText);
        var response = JSON.parse(xhr.responseText);
        if(xhr.status == 200) {
            multipleFileUploadError.style.display = "none";
            var content = "<p>All Files Uploaded Successfully</p>";
            for(var i = 0; i < response.length; i++) {
                content += "<p>DownloadUrl : <a href='" + response[i].fileDownloadUri + "' target='_blank'>" + response[i].fileDownloadUri + "</a></p>";
            }
            multipleFileUploadSuccess.innerHTML = content;
            multipleFileUploadSuccess.style.display = "block";
        } else {
            multipleFileUploadSuccess.style.display = "none";
            multipleFileUploadError.innerHTML = (response && response.message) || "Some Error Occurred";
        }
    }

    xhr.send(formData);
}


singleUploadForm.addEventListener('submit', function(event){
    var files = singleFileUploadInput.files;
    if(files.length === 0) {
        singleFileUploadError.innerHTML = "Please select a file";
        singleFileUploadError.style.display = "block";
    }
    uploadSingleFile(files[0]);
    event.preventDefault();
}, true);


multipleUploadForm.addEventListener('submit', function(event){
    var files = multipleFileUploadInput.files;
    if(files.length === 0) {
        multipleFileUploadError.innerHTML = "Please select at least one file";
        multipleFileUploadError.style.display = "block";
    }
    uploadMultipleFiles(files);
    event.preventDefault();
}, true);
}
</script>

</head>
<body>
  <div class="upload-container">
      <div class="upload-header">
          <h2>Spring Boot File Upload / Download Rest API Example</h2>
      </div>
      <div class="upload-content">
      
          <div class="single-upload">
              <h3>단일 파일 업로드</h3>
              <form id="singleUploadForm" name="singleUploadForm">
                  <input id="singleFileUploadInput" type="file" name="file" class="file-input" required />
                  <button type="submit" class="primary submit-btn">Submit</button>
              </form>
              <div class="upload-response">
                  <div id="singleFileUploadError"></div>
                  <div id="singleFileUploadSuccess"></div>
              </div>
          </div>
          
          <div class="multiple-upload">
              <h3>다중 파일 업로드</h3>
              <form id="multipleUploadForm" name="multipleUploadForm">
                  <input id="multipleFileUploadInput" type="file" name="files" class="file-input" multiple required />
                  <button type="submit" class="primary submit-btn">Submit</button>
              </form>
              <div class="upload-response">
                  <div id="multipleFileUploadError"></div>
                  <div id="multipleFileUploadSuccess"></div>
              </div>
          </div>
      </div>
  </div>
</body>
</html>